name: CI - Testes e Build

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    name: ğŸ§ª Testes
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“š Instalar dependÃªncias
        run: npm ci

      - name: ğŸ§ª Executar testes
        run: npm run test:run

      - name: ğŸ“Š Gerar relatÃ³rio de cobertura
        run: npm run test:coverage

      - name: ğŸ“¤ Upload cobertura para Codecov
        uses: codecov/codecov-action@v4
        with:
          file: ./coverage/coverage-final.json
          flags: unittests
          name: siav-coverage

  build:
    name: ğŸ—ï¸ Build de ProduÃ§Ã£o
    runs-on: ubuntu-latest
    needs: test

    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“š Instalar dependÃªncias
        run: npm ci

      - name: ğŸ—ï¸ Build otimizado
        run: npm run build

      - name: ğŸ“¤ Upload artefato de build
        uses: actions/upload-artifact@v4
        with:
          name: build-optimized
          path: build-optimized/
          retention-days: 7

  lint:
    name: ğŸ” Linting e Qualidade
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ” Verificar sintaxe JavaScript
        run: |
          find src -name "*.js" -type f -exec node -c {} \;
          echo "âœ… Sintaxe JavaScript vÃ¡lida"

      - name: ğŸ“ Verificar tamanho dos arquivos
        run: |
          echo "ğŸ“Š Tamanho dos arquivos principais:"
          ls -lh script.js style.css index.html
          echo "âœ… VerificaÃ§Ã£o de tamanho concluÃ­da"
